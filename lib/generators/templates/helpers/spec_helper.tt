# frozen_string_literal: true

require 'active_support/all'
require 'rspec'
require_relative 'allure_helper'
<%= ERB.new(File.read(File.expand_path('./partials/require_driver.tt', __dir__))).result(binding).strip! %>

module Raider
    module SpecHelper

    AllureHelper.configure
    RSpec.configure do |config|
        config.formatter = AllureHelper.formatter
        config.before(:each) do
            <%= ERB.new(File.read(File.expand_path('./partials/select_helper.tt', __dir__))).result(binding).strip! %>
            <% if %w[appium_ios].include? automation %>
            DriverHelper.driver.start_driver
            <% end %>
        end

        config.after(:each) do
            example_name = self.class.descendant_filtered_examples.first.description
            status = self.class.descendant_filtered_examples.first.execution_result.status
            <%= ERB.new(File.read(File.expand_path('./partials/screenshot.tt', __dir__))).result(binding).strip! %>
            AllureHelper.add_screenshot example_name if status == :failed
            <%= ERB.new(File.read(File.expand_path('./partials/quit_driver.tt', __dir__))).result(binding).strip! %>
            end
          end
    end
end
